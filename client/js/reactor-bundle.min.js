/*
 *  Licensed Materials - Property of IBM
 *  5725E28, 5725I03
 *  Â© Copyright IBM Corp. 2014
 *  US Government Users Restricted Rights - Use, duplication or disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
 */
var Reactor=window.Reactor={Conditions:{},Storage:{}};(function(){var t,e,n,r,i,o,s,a,u,c,l,f,h,p,d,g,m,v,R,y,S,M,C,w,b,N,k,A,T,_,O,D,x,E,L,j,q,I,F,V={}.hasOwnProperty,K=function(t,e){function n(){this.constructor=t}for(var r in e)V.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},H=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Reactor.Object=function(){function t(){}return t.sdkVersion="1.5.0",t}(),a=Reactor.Storage.Archive=function(t){function e(t){this.prefix=null!=t?t:"",this.prefix=a.globalPrefix+this.prefix,this.storage=localStorage}return K(e,t),e.globalPrefix="_xr_",e.storage=localStorage,e.prototype.getStorageKey=function(t){return this.prefix+t},e.prototype.removePrefix=function(t){return 0===t.indexOf(this.prefix)&&t.length>this.prefix.length?t.substring(this.prefix.length):t},e.prototype.set=function(t,e,n){var r;return null==n&&(n=null),t=this.getStorageKey(t),r={val:e},null!=n&&(r.exp=(new Date).getTime()+n),this.storage.setItem(t,JSON.stringify(r))},e.prototype.get=function(t,e){var n,r;return null==e&&(e=null),t=this.getStorageKey(t),r=this.storage.getItem(t),null!=r?(r=JSON.parse(r),null!=r.exp&&(n=(new Date).getTime(),r.exp<n)?(this.storage.removeItem(t),e):r.val):e},e.prototype.has=function(t){return t=this.getStorageKey(t),null!=this.storage[t]},e.prototype.clear=function(){var t,e,n,r,i;for(r=this.keys(),i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(delete this.storage[this.getStorageKey(t)]);return i},e.prototype.getTTL=function(t){var e,n;return t=this.getStorageKey(t),n=this.storage.getItem(t),null!=n&&(n=JSON.parse(n),null!=n.exp)?(e=(new Date).getTime(),new Reactor.Duration(n.exp-e)):null},e.prototype.remove=function(t){return t=this.getStorageKey(t),this.storage.removeItem(t)},e.prototype.keys=function(){var t,e,n;return e=new RegExp("^"+this.prefix),function(){var r,i;r=this.storage,i=[];for(t in r)n=r[t],null!==t.match(e)&&i.push(this.removePrefix(t));return i}.call(this)},e.removeByPrefix=function(t){var e,n,r,i;r=a.storage,i=[];for(e in r)n=r[e],0===e.indexOf(t)?i.push(delete this.storage[e]):i.push(void 0);return i},e.resetAllStorage=function(){return this.removeByPrefix(a.globalPrefix)},e}(Reactor.Object),_=Reactor.Log,Reactor.MetricsArchive=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.storage=new Reactor.Storage.Archive("met_"),e.set=function(t,e){return this.storage.set(t,e)},e.get=function(t){return this.storage.get(t)},e.remove=function(t){return this.storage.remove(t)},e.keys=function(){return this.storage.keys()},e.clear=function(){return this.storage.clear()},e}(Reactor.Object),_=Reactor.Log,Reactor.MetricsManager=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.actions={OPEN:"AO",VIEW:"NRDI",CLICK:"NRA"},e.getMetricKey=function(t){return t.a+"_"+t.ms},e.report=function(t,e){var n,r,i;return i=new Date,n={},t={a:t,t:i.toISOString(),ms:i.getTime()},null!=e?(t.cid=e,n.ca=[t]):n.aa=[t],r=this.getMetricKey(t),Reactor.MetricsArchive.set(r,n),this.send(r,n)},e.send=function(t,e){var n,r;return r=function(){return Reactor.MetricsArchive.remove(t)},n=function(e,n){return 404===n.status?Reactor.MetricsArchive.remove(t):void 0},Reactor.Ajax.ajax({method:"POST",dataType:"json",url:Reactor.Settings.Api.metrics,data:e,success:r,error:n})},e.retryStoredMetrics=function(){var t,e,n,r,i,o;for(e=Reactor.MetricsArchive.keys(),o=[],r=0,i=e.length;i>r;r++)t=e[r],n=Reactor.MetricsArchive.get(t),o.push(this.send(t,n));return o},e}(Reactor.Object),D=Reactor.MetricsManager,x=Reactor.NotificationManager=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.defaultOnBeforeMessageCallback=function(t){return t},e.onBeforeMessageCallback=e.defaultOnBeforeMessageCallback,e.defaultOnMessageCallback=function(t){return _.info(t)},e.onMessageCallback=e.defaultOnMessageCallback,e.onAfterMessageCallback=function(){return null},e.getMessages=function(t){var e,n;if(null!=t&&0!==t.length)return n=this.selectMids(t),0===n.length?(_.info("All messages failed experience rules."),void 0):e=new Reactor.MessageBatch(n,this.displayMessages)},e.selectMids=function(t){var e,n,r,i,o,s,a;for(r=[],i=0,s=t.length;s>i;i++)for(n=t[i],o=0,a=n.length;a>o;o++)if(e=n[o],Reactor.ExperienceRules.passes(e)){r.push(e);break}return r},e.displayMessages=function(t){var e,n,r,i,o,s;if(n=function(){},null!=x.onBeforeMessageCallback&&(t=x.onBeforeMessageCallback(t)||t),null!=x.onMessageCallback){for(s=[],i=0,o=t.length;o>i;i++)e=t[i],null==e.error?(e.body='<span class="reactor-msg" data-mid="'+e.mid+'" data-cid="'+e.cid+'">'+e.body+"</span>",r=function(){var t;return Reactor.ExperienceRules.updateMessageHistory(e.mid),D.report(D.actions.VIEW,e.cid),t=x.onMessageCallback(e),null!=x.onAfterMessageCallback&&t!==!1?x.onAfterMessageCallback(e):void 0},null!=e.delay?s.push(setTimeout(r,e.delay)):s.push(r())):_.info("Skipping message "+e.mid+": "+e.error);return s}},e}(Reactor.Object),_=Reactor.Log,Reactor.JSON=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.requiredFields=function(t,e,n){var r,i,o,s,a;for(r=function(t,n){return null==t[n]?new Reactor.Error("Missing required field '"+n+"' in "+e+" object."):null===t?new Reactor.Error("Required field '"+n+"' in "+e+" object cannot be null."):void 0},a=[],o=0,s=n.length;s>o;o++)i=n[o],a.push(r(t,i));return a},e.requiredFieldsNullOk=function(t,e,n){var r,i,o,s,a;for(r=function(t,n){return null==t[n]&&null!==t[n]?new Reactor.Error("Missing required field '"+n+"' in "+e+" object."):void 0},a=[],o=0,s=n.length;s>o;o++)i=n[o],a.push(r(t,i));return a},e.optionalFields=function(t,e,n){var r,i,o,s,a;for(r=function(e,n){return null!=t[n]?e[n]=t[n]:void 0},a=[],o=0,s=n.length;s>o;o++)i=n[o],a.push(r(e,i));return a},e.mapFields=function(t,e){var n,r,i,o;r={},i=function(t,n){return null!=e[t]&&(t=e[t]),r[t]=n};for(n in t)o=t[n],i(n,o);return r},e.mapValue=function(t,e){return null!=e[t]?e[t]:t},e}(Reactor.Object),_=Reactor.Log,Reactor.Dom=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.signature="Reactor",e.head=function(){return document.head||this.addHead()},e.addHead=function(){var t,e;return t=this.create("head",null,{"data-created-by":this.signature}),e=this.selectOne("html"),e.insertBefore(t,e.firstChild),t},e.body=function(){return document.body||this.addBody()},e.addBody=function(){var t,e;return t=this.create("body",null,{"data-created-by":this.signature}),e=this.selectOne("html"),e.appendChild(t),t},e.addStyle=function(t,e){var n,r;return null==e&&(e=!1),r=this.create("style",null,{"data-created-by":"Reactor"}),r.appendChild(document.createTextNode(t)),n=this.head(),e===!0?n.appendChild(r):n.insertBefore(r,n.firstChild),r},e.create=function(t,e,n){var r,i,o;null==e&&(e=null),null==n&&(n={}),i=document.createElement(t),null!=e&&(i.innerHTML=e);for(r in n)o=n[r],this.attr(i,r,o);return i},e.attr=function(t,e,n,r){var i,o;return null==n&&(n=null),null==r&&(r=document),o=this.asNodeList(t,r),null!=n?function(){var t,r,s;for(s=[],t=0,r=o.length;r>t;t++)i=o[t],s.push(i.setAttribute(e,n));return s}():function(){var t,n,r;for(r=[],t=0,n=o.length;n>t;t++)i=o[t],r.push(i.getAttribute(e));return r}()},e.style=function(t,e,n,r){var i,o;return null==r&&(r=document),o=this.asNodeList(t,r),null!=n?function(){var t,r,s;for(s=[],t=0,r=o.length;r>t;t++)i=o[t],s.push(i.style[e]=n);return s}():function(){var t,n,r;for(r=[],t=0,n=o.length;n>t;t++)i=o[t],r.push(i.style[e]);return r}()},e.append=function(t,e,n){var r,i,o,s;for(null==n&&(n=document),i=this.asNodeList(t,n),o=0,s=i.length;s>o;o++)r=i[o],r.appendChild(e.cloneNode(!0));return i},e.prepend=function(t,e,n){var r,i,o,s;for(null==n&&(n=document),i=this.asNodeList(t,n),o=0,s=i.length;s>o;o++)r=i[o],r.insertBefore(e.cloneNode(!0),r.firstChild);return i},e.select=function(t,e){return null==e&&(e=document),e.querySelectorAll(t)},e.selectOne=function(t,e){return null==e&&(e=document),e.querySelector(t)},e.html=function(t,e,n){var r,i,o,s;for(null==n&&(n=document),i=this.asNodeList(t,n),o=0,s=i.length;s>o;o++)r=i[o],r.innerHTML=e;return i},e.asNodeList=function(t,e){var n;return null==e&&(e=document),n=this.isNode(t)?[t]:Array.isArray(t||t instanceof NodeList)?t:this.select(t,e)},e.isNode=function(t){try{return t instanceof HTMLElement}catch(e){return"object"==typeof t&&null!=t.nodeType&&null!=t.style}},e.ready=function(t){return document.addEventListener("DOMContentLoaded",t)},e.registerEvent=function(t,e,n,r){var i,o=this;return null==r&&(r=document),i=function(e){var r,i;return r=o.closest(e.target,t),null!=r?i=n(r,e):!0},r.addEventListener(e,i),n},e.closest=function(t,e){var n,r;return r=this.clonedToRoot(t),n=r.root.querySelectorAll(e),0===n.length?null:n[n.length-1].realNode},e.is=function(t,e){var n,r;return null==(null!=(r=t.parentNode)?r.querySelector:void 0)?!1:(n=this.clonedToRoot(t),n.leaf===n.leaf.parentNode.querySelector(e))},e.clonedToRoot=function(t){var e,n,r;return r=t.cloneNode(!1),r.realNode=t,t.parentNode===document||null===t.parentNode?(n=this.create("div","",{"class":"fakeDocument"}),n.appendChild(r),{root:n,leaf:r}):(e=this.clonedToRoot(t.parentNode),e.leaf.appendChild(r),{root:e.root,leaf:r})},e}(Reactor.Object),T=Reactor.JSON,_=Reactor.Log,p=Reactor.Conditions.Condition=function(t){function e(t){this.type=t}return K(e,t),e.escapeRegex=function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},e.testEQ=function(t,e){return t==e},e.testNE=function(t,e){return t!=e},e.testGT=function(t,e){return t>e},e.testLT=function(t,e){return e>t},e.testGTE=function(t,e){return t>=e},e.testLTE=function(t,e){return e>=t},e.testRegex=function(t,e){return new RegExp(p.escapeRegex(e)).test(t)},e.testStartsWith=function(t,e){return new RegExp("^"+p.escapeRegex(e)).test(t)},e.testEndsWith=function(t,e){return new RegExp(p.escapeRegex(e)+"$").test(t)},e.testContains=function(t,e){return new RegExp(".*"+p.escapeRegex(e)+".*").test(t)},e.testHasTag=function(t){return Reactor.Client.hasTag(t)},e.tests={eq:e.testEQ,ne:e.testNE,gt:e.testGT,lt:e.testLT,gte:e.testGTE,lte:e.testLTE,hasTag:e.testHasTag,startsWith:e.testStartsWith,endsWith:e.testEndsWith,contains:e.testContains,regex:e.testRegex},e.prototype.runTest=function(t,e,n,r){var i,o;return o=p.tests[e],null!=o?i=o(n,r):!1},e.prototype.isSatisfied=function(t){var e,n,r,i;return"attr"===this.valueType?(null==this.attrName&&new Reactor.Error("No attribute name was provided when the Condition was constructed."),e=Reactor.Client.getAttribute(this.attrName)):"tag"===this.valueType?e=this.value:(i="get"+this.valueType.charAt(0).toUpperCase()+this.valueType.substring(1),i in t?e=t[i]():new Reactor.Error("No such EventInstance property:",this.valueType)),this.test in p.tests?(r=p.tests[this.test],n=r(e,this.value)):new Reactor.Error("No such test: "+this.test)},e.unpack=function(t){var e,n;return T.requiredFields(t,"Condition",["et"]),e=Reactor.Conditions.ConditionMasterList.smallTypeNames[t.et],n=Reactor.Conditions.ConditionMasterList.types[e].unpack(t)},e.fieldMap={type:"et"},e.pack=function(t){var e;return e=T.mapFields(t,this.fieldMap),e.et=T.mapValue(e.et,Reactor.Conditions.ConditionMasterList.bigTypeNames),Reactor.Conditions.ConditionMasterList.types[t.type].pack(e)},e}(Reactor.Object),T=Reactor.JSON,m=Reactor.Conditions.CountCondition=function(t){function e(t,n){this.test=null!=t?t:"eq",this.value=null!=n?n:"",e.__super__.constructor.call(this,"count")}return K(e,t),e.prototype.isSatisfied=function(t){return this.runTest("count",this.test,t.getCount(),this.value)},e.unpack=function(t){return T.requiredFields(t,"CountCondition",["t","v"]),new m(t.t,t.v)},e.fieldMap={test:"t",value:"v"},e.pack=function(t){return T.mapFields(t,this.fieldMap)},e}(Reactor.Conditions.Condition),Reactor.Conditions.MembershipCondition=function(t){function e(t){this.name=null!=t?t:"",e.__super__.constructor.call(this,"mem")}return K(e,t),e.prototype.isSatisfied=function(){return Reactor.Client.hasMembership(this.name)},e.unpack=function(t){return Reactor.JSON.requiredFields(t,"Membership",["m"]),new o(t.m)},e.fieldMap={name:"m"},e.pack=function(t){return Reactor.JSON.mapFields(t,this.fieldMap)},e}(Reactor.Conditions.Condition),T=Reactor.JSON,L=Reactor.Conditions.ReferrerCondition=function(t){function e(t,n){this.test=null!=t?t:"",this.value=null!=n?n:"",e.__super__.constructor.call(this,"ref")}return K(e,t),e.prototype.isSatisfied=function(){return this.runTest("ref",this.test,document.referrer,this.value)},e.unpack=function(t){return T.requiredFields(t,"ReferrerCondition",["t","v"]),new L(t.t,t.v)},e.fieldMap={test:"t",value:"v"},e.pack=function(t){return T.mapFields(t,this.fieldMap)},e}(Reactor.Conditions.Condition),T=Reactor.JSON,I=Reactor.Conditions.SinceCondition=function(t){function e(t,n){this.test=null!=t?t:"gte",this.value=null!=n?n:0,e.__super__.constructor.call(this,"since")}return K(e,t),e.prototype.isSatisfied=function(t){return this.runTest("since",this.test,t.getTimeSinceLast(),this.value)},e.unpack=function(t){return T.requiredFields(t,"SinceCondition",["t","v"]),new I(t.t,t.v)},e.fieldMap={test:"t",value:"v"},e.pack=function(t){return T.mapFields(t,this.fieldMap)},e}(Reactor.Conditions.Condition),T=Reactor.JSON,_=Reactor.Log,F=Reactor.Conditions.TimeCondition=function(t){function e(t,n,r,i){this.startHour=null!=t?t:0,this.startMin=null!=n?n:0,this.endHour=null!=r?r:23,this.endMin=null!=i?i:59,e.__super__.constructor.call(this,"time")}return K(e,t),e.prototype.isSatisfied=function(){var t,e;if(t=new Date,this.startHour<=t.getHours()){if(!(t.getHours()<=this.endHour))return!1;if(t.getHours()<this.endHour)return!0;if(t.getHours()===this.endHour)return this.startMin<=(e=t.getMinutes())&&e<=this.endMin?!0:!1}},e.unpack=function(t){return T.requiredFields(t,"TimeCondition",["sh","sm","eh","em"]),new F(t.sh,t.sm,t.eh,t.em)},e.fieldMap={startHour:"sh",startMin:"sm",endHour:"eh",endMin:"em"},e.pack=function(t){return T.mapFields(t,this.fieldMap)},e}(Reactor.Conditions.Condition),T=Reactor.JSON,_=Reactor.Log,v=Reactor.Conditions.DayCondition=function(t){function e(t){this.days=null!=t?t:[],e.__super__.constructor.call(this,"day")}return K(e,t),e.prototype.isSatisfied=function(){var t,e;return t=new Date,e=t.getDay(),H.call(this.days,e)<0?!1:!0},e.unpack=function(t){return T.requiredFields(t,"DayCondition",["d"]),new v(t.d)},e.fieldMap={days:"d"},e.pack=function(t){return T.mapFields(t,this.fieldMap)},e}(Reactor.Conditions.Condition),Reactor.Storage.ListArchive=function(t){function e(t){this.storage=new Reactor.Storage.Archive(t),this.listKey="l"}return K(e,t),e.prototype.add=function(t){var e;return e=this.storage.get(this.listKey,{}),e[t]=!0,this.storage.set(this.listKey,e)},e.prototype.remove=function(t){var e;return e=this.storage.get(this.listKey,{}),delete e[t],this.storage.set(this.listKey,e)},e.prototype.setList=function(t){var e,n,r,i;for(n={},r=0,i=t.length;i>r;r++)e=t[r],n[e]=!0;return this.storage.set(this.listKey,n)},e.prototype.getList=function(){var t,e,n,r;return n=this.storage.get(this.listKey,{}),e=function(){var e;e=[];for(t in n)r=n[t],e.push(t);return e}()},e.prototype.has=function(t){var e;return e=this.storage.get(this.listKey,{}),null!=e[t]},e}(Reactor.Object),Reactor.Error=function(t){function e(t){throw this.errorMessage=t,"Reactor Exception: "+this.errorMessage}return K(e,t),e}(Reactor.Object),p=Reactor.Conditions.Condition,Reactor.Expression=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.unpack=function(t){return"cl"===t.et?Reactor.Clause.unpack(t):p.unpack(t)},e.pack=function(t){return null!=t.exp?Reactor.Clause.pack(t):p.pack(t)},e}(Reactor.Object),T=Reactor.JSON,R=Reactor.DisplayRule,y=Reactor.DisplayRuleSet=function(t){function e(t){this.displayRuleSet=null!=t?t:[]}return K(e,t),e.prototype.addRule=function(t){return this.displayRuleSet.push(t)},e.prototype.getRule=function(t){return this.displayRuleSet[t]},e.prototype.setRule=function(t,e){return this.displayRuleSet[t]=e},e.prototype.size=function(){return this.displayRuleSet.length},e.prototype.getSatisfiedRules=function(t){var e;return function(){var n,r,i,o;for(i=this.displayRuleSet,o=[],n=0,r=i.length;r>n;n++)e=i[n],e.isSatisfied(t)&&o.push(e);return o}.call(this)},e.fieldMap={displayRuleSet:"drs"},e.pack=function(t){var e,n;return n=T.mapFields(t,this.fieldMap),n.drs=function(){var t,r,i,o;for(i=n.drs,o=[],t=0,r=i.length;r>t;t++)e=i[t],o.push(R.pack(e));return o}(),n},e.unpack=function(t){var e,n;return T.requiredFields(t,"DisplayRuleSet",["drs"]),n=function(){var n,r,i,o;for(i=t.drs,o=[],n=0,r=i.length;r>n;n++)e=i[n],o.push(R.unpack(e));return o}(),new y(n)},e}(Reactor.Object),C=Reactor.Duration=function(t){function e(t){var e;this.raw=t,e=this.raw,this.ms=e%1e3,e=parseInt(e/1e3),this.seconds=e%60,e=parseInt(e/60),this.minutes=e%60,e=parseInt(e/60),this.hours=e%24,e=parseInt(e/24),this.days=e%7,e=parseInt(e/7),this.weeks=parseInt(e)}return K(e,t),e.unitsAsMS={weeks:6048e5,days:864e5,hours:36e5,minutes:6e4,seconds:1e3,ms:1},e.unitsSmallToBig=["ms","seconds","minutes","hours","days","weeks"],e.unitsBigToSmall=["weeks","days","hours","minutes","seconds","ms"],e.prototype.toString=function(){var t,e,n,r;t="",r=C.unitsAsMS;for(e in r)n=r[e],this[e]>0&&(t+=this[e]+" "+e+" ");return t.trim()},e.prototype.largestCommonUnit=function(){var t,e,n,r;for(r=C.unitsBigToSmall,e=0,n=r.length;n>e;e++)if(t=r[e],this[t]>0)return t;return"ms"},e.prototype.asUnit=function(t){return this.raw/C.unitsAsMS[t]},e.prototype.plural=function(t,e){return 1===t?e:e+"s"},e}(Reactor.Object),Reactor.Settings={Api:{}},_=Reactor.Log=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.levels={trace:0,debug:1,info:2,warn:3,error:4},e.defaultLevel=3,e.defaultLevelName="warn",e.level=e.defaultLevel,e.levelName=e.defaultLevelName,e.setLevel=function(t){var n;return null!=e.levels[t]?(n=e.levelName,e.level=e.levels[t],e.levelName=t,e.info("Changing log level from "+n+" to '"+t+"'")):e.error("No such log level: "+t)},e.log=function(t,n){var r;return r=Array.prototype.slice.call(n),e.levels[t]>=e.level?null!=console[t]?console[t].apply(console,r):(r.unshift(""+t.toUpperCase()+":"),console.log.apply(console,r)):void 0},e.trace=function(){return this.log("trace",arguments)},e.debug=function(){return this.log("debug",arguments)},e.info=function(){return this.log("info",arguments)},e.warn=function(){return this.log("warn",arguments)},e.error=function(){return this.log("error",arguments)},e}.call(this,Reactor.Object),_=Reactor.Log,Reactor.Ajax=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.ajax=function(t){var e,n,r,i,o,s,a,u,c,l,f,h,p,d,g;for(i=function(e){return null==t[e]?new Reactor.Error("Missing field '"+e+"' in ajax options"):void 0},h=["url","method","dataType","success","error"],u=0,l=h.length;l>u;u++)n=h[u],i(n);if("json"!==(p=t.dataType)&&"text"!==p&&new Reactor.Error("Unsupported value specified for ajax dataType: '"+t.dataType+"'"),t.method=t.method.toUpperCase(),t.datatype=t.dataType.toLowerCase(),a=new XMLHttpRequest,e="",o=function(t,n){var r,i,s,a;if(Array.isArray(n)){for(a=[],i=0,s=n.length;s>i;i++)r=n[i],a.push(o(t,r));return a}return e+=""+t+"="+n+"&"},null!=t.data)if("GET"===t.method)for(d=t.data,s=c=0,f=d.length;f>c;s=++c)r=d[s],o(r,s);else e=JSON.stringify(t.data);return a.open(t.method,t.url,!0),("POST"===(g=t.method)||"PUT"===g)&&a.setRequestHeader("Content-type","application/json"),a.onreadystatechange=function(){var n;if(4===a.readyState)return 200!==(n=a.status)&&204!==n&&304!==n?t.error(a.responseText,a):(e="json"===t.dataType?""===a.responseText?"":JSON.parse(a.responseText):a.responseText,t.success(e,a))},a.send(e)},e.multi=function(t,e,n,r){var i,o,s,a,u,c,l,f,h,p,d;for(l=[],s=0,a=0,i=function(t){var r,i,u;if("string"==typeof t)u={},u.url=t,u.method="GET",u.dataType="json",u.success=null,u.error=null;else{if(null==t.url)return _.warn("Omitting malformed request:",t),void 0;u=t,null==t.method&&(u.method="GET"),null==t.dataType&&(u.dataType="json")}return null!=u.success?(i=u.success,u.success=function(t){return a+=1,i(u,t),o()}):u.success=function(t){return a+=1,e(u,t),o()},null!=u.error?(r=u.error,u.error=function(t){return s+=1,r(u,t),o()}):u.error=function(t){return s+=1,n(u,t),o()},l.push(u)},o=function(){return s+a>=l.length&&null!=r?r(a,s):void 0},f=0,p=t.length;p>f;f++)u=t[f],i(u);for(h=0,d=l.length;d>h;h++)c=l[h],this.ajax(c);return o()},e}(Reactor.Object),T=Reactor.JSON,u=Reactor.Attribute=function(t){function e(t,e,n){this.key=t,this.value=e,this.type=n,null!=this.type?null==u.types[this.type]&&u.unsupportedTypeError():this.type=u.guessType(this.value),"date"===this.type&&(this.value=new Date(this.value))}return K(e,t),e.guessType=function(t){return!isNaN(parseFloat(t))&&isFinite(t)?"number":"string"==typeof t||t instanceof String?"string":t===!0||t===!1?"boolean":t instanceof Date&&!isNaN(t.valueOf())?"date":new Reactor.Error("Type of attribute value <"+t+"> could not be determined automatically.")},e.unsupportedTypeError=function(){var t,e;return e=function(){var e,n,r,i;for(r=this.types,i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(t);return i}.call(this),new Reactor.Error("No such attribute type '"+this.type+"'. Supported types: "+e.join(", "))},e.unpack=function(t){var e,n;return Reactor.JSON.requiredFields(t,"Attribute",["k","t","v"]),e=T.mapValue(t.t,this.shortTypes),n=new u(t.k,t.v,e)},e.types={integer:"i","long":"l","double":"d",number:"d",string:"s","boolean":"b",date:"dt"},e.shortTypes={i:"integer",l:"long",d:"double",s:"string",b:"boolean",dt:"date"},e.fieldMap={key:"k",type:"t",value:"v"},e.pack=function(t){var e;return t.type=T.mapValue(t.type,this.types),e=T.mapFields(t,this.fieldMap)},e}(Reactor.Object),u=Reactor.Attribute,C=Reactor.Duration,j=Reactor.Settings,_=Reactor.Log,Reactor.AttributeArchive=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.storage=new Reactor.Storage.Archive("attr_"),e.set=function(t,e,n){var r;return r=new Reactor.Attribute(t,e,n),this.storage.set(t,u.pack(r))},e.get=function(t){var e;return e=this.storage.get(t,null),null!=e&&(e=u.unpack(e)),e},e.has=function(t){return this.storage.has(t)},e.remove=function(t){return this.storage.remove(t)},e.keys=function(){return this.storage.keys()},e.clear=function(){return this.storage.clear()},e}(Reactor.Object),T=Reactor.JSON,b=Reactor.Error,A=Reactor.Expression,_=Reactor.Log,f=Reactor.Clause=function(t){function e(t,e){this.op=null!=t?t:"all",this.exp=null!=e?e:[],this.type="cl",this.setOp(this.op)}return K(e,t),e.satOps={any:"anySatisfied",an:"anySatisfied",all:"allSatisfied",al:"allSatisfied",none:"noneSatisfied",no:"noneSatisfied"},e.prototype.genIsSatisfied=function(t){return this.isSatisfied=function(e){var n;return _.info("Checking if '"+this.op+"' of these are true for:",this),n=this[t](e),_.info("Result:"+(""+n).toUpperCase()),n}},e.prototype.anySatisfied=function(t){var e,n,r,i;if(0===this.exp.length)return!0;for(i=this.exp,n=0,r=i.length;r>n;n++)if(e=i[n],e.isSatisfied(t))return!0;return!1},e.prototype.allSatisfied=function(t){var e,n,r,i;if(0===this.exp.length)return!0;for(i=this.exp,n=0,r=i.length;r>n;n++)if(e=i[n],!e.isSatisfied(t))return!1;return!0},e.prototype.noneSatisfied=function(t){var e,n,r,i;if(0===this.exp.length)return!0;for(i=this.exp,n=0,r=i.length;r>n;n++)if(e=i[n],e.isSatisfied(t))return!1;return!0},e.prototype.setOp=function(t){var e;return this.op=t,e=!this.op,H.call(f.satOps,e)>=0&&new b("Invalid Reactor.Clause op: "+this.op),this.genIsSatisfied(f.satOps[this.op])},e.prototype.addExpression=function(t){return this.exp.push(t)},e.prototype.removeExpression=function(t){var e;return e=this.exp.indexOf(t),-1!==e?this.exp.splice(e,1):void 0},e.prototype.replaceExpression=function(t,e){var n;return n=this.exp.indexOf(t),-1!==n?this.exp[n]=e:void 0},e.prototype.setParent=function(t){this.parent=t},e.unpack=function(t){var e,n,r;return T.requiredFields(t,"Clause",["o","e"]),n=function(){var n,r,i,o;for(i=t.e,o=[],n=0,r=i.length;r>n;n++)e=i[n],o.push(A.unpack(e));return o}(),t.o=this.revOpMap[t.o],r=new f(t.o,n)},e.fieldMap={type:"et",op:"o",exp:"e"},e.revOpMap={an:"any",al:"all",no:"none"},e.opMap={any:"an",all:"al",none:"no"},e.pack=function(t){var e,n;return n=T.mapFields(t,this.fieldMap),n.o=T.mapValue(n.o,this.opMap),n.e=function(){var t,r,i,o;for(i=n.e,o=[],t=0,r=i.length;r>t;t++)e=i[t],o.push(A.pack(e));return o}(),n},e}(Reactor.Object),_=Reactor.Log,u=Reactor.Attribute,c=Reactor.AttributeArchive,h=Reactor.Client=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.defaultOnAttributeChange=function(){return null},e.onAttributeChangeHandler=e.defaultOnAttributeChange,e.onAttributeChange=function(t){var e;return null!=t?(e=this.onAttributeChangeHandler,this.onAttributeChangeHandler=t,e):this.onAttributeChangeHandler},e.segments=new Reactor.Storage.ListArchive("segs_"),e.getSegments=function(){return this.segments.getList()},e.setSegments=function(t){return this.segments.setList(t)},e.hasSegment=function(t){return this.segments.has(t)},e.addSegment=function(t){return this.segments.add(t)},e.removeSegment=function(t){return this.segments.remove(t)},e.attributes=new Reactor.AttributeArchive,e.getAttribute=function(t,e){var n;return null==e&&(e=null),n=c.get(t,void 0),null!=n?n.value:e},e.setAttribute=function(t,e,n){var r,i;return r=c.get(t,null),i=null!=r&&null!=r.value?r.value:void 0,c.set(t,e,n),this.onAttributeChangeHandler(t,i,e)},e.hasAttribute=function(t){return c.has(t)},e.removeAttribute=function(t){var e,n;return e=c.get(t,null),n=null!=e&&null!=e.value?e.value:void 0,c.remove(t),this.onAttributeChangeHandler(t,n,void 0)},e.getPackedAttributes=function(){var t,e,n,r,i;for(r=c.keys(),i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(u.pack(c.get(t)));return i},e.getAttributeKeys=function(){var t,e,n,r,i;for(r=c.keys(),i=[],e=0,n=r.length;n>e;e++)t=r[e],i.push(t);return i},e.segmentRequestQueue=[],e.segmentRequestInProgress=!1,e.updateSegments=function(t,e){var n,r;return n=Reactor.Client.getPackedAttributes(),r={url:Reactor.Settings.Api.segments,method:"PUT",dataType:"json",data:{attributes:n},success:function(e){return Reactor.Client.segments.setList(e.segments),Reactor.DisplayRuleSetArchive.clear(),Reactor.Client.segmentRequestInProgress=!1,Reactor.Client.fireSegmentRequest(),null!=t?t(e.auds):void 0},error:function(t){return _.error("Couldn't update segments:",t),Reactor.Client.segmentRequestInProgress=!1,Reactor.Client.fireSegmentRequest(),null!=e?e(t):void 0},obe:function(){return _.warn("Segment request OBE. Discarded."),null!=e?e("OBE"):void 0}},this.queueSegmentRequest(r)},e.queueSegmentRequest=function(t){return 0===this.segmentRequestQueue.length,this.segmentRequestQueue.push(t),this.fireSegmentRequest()},e.fireSegmentRequest=function(){return this.segmentRequestInProgress||0===this.segmentRequestQueue.length?void 0:(this.segmentRequestInProgress=!0,Reactor.Ajax.ajax(this.segmentRequestQueue.shift()))},e.getQueryVars=function(){var t,e,n,r,i,o,s;for(i=window.location.search.substring(1),n=i.split("&"),t={},r=function(e){var n,r,i;return i=e.split("="),n=i[0],r=i[1],t[n]=r},o=0,s=n.length;s>o;o++)e=n[o],r(e);return t},e.getDataSdkVersionKey=function(){return Reactor.Storage.Archive.globalPrefix+"sdk_v"},e.getDataSdkVersion=function(){return localStorage.getItem(this.getDataSdkVersionKey())},e.setDataSdkVersion=function(t){return localStorage.setItem(this.getDataSdkVersionKey(),t)},e.upgradeRequired=function(){return this.getDataSdkVersion()!==Reactor.Client.sdkVersion},e.upgrade=function(){return Reactor.reset(),this.setDataSdkVersion(Reactor.Client.sdkVersion)},e.updateSession=function(){var t,e,n,r,i,o;return this.upgradeRequired()&&(_.info("This is a new version of the SDK. Clearing incompatible stored data."),this.upgrade()),n=function(t,e){return t.getFullYear()!==e.getFullYear()},e=function(t,e){return n(t,e)||t.getMonth()!==e.getMonth()},o=new Date,r=Reactor.Storage.Archive.globalPrefix+"visit",i=parseInt(localStorage.getItem(r)),null!=i?(Reactor.MetricsManager.retryStoredMetrics(),e(o,new Date(i))&&(_.info("This visit is a monthly unique."),Reactor.MetricsManager.report(Reactor.MetricsManager.actions.OPEN))):(_.info("This is the user's first visit."),this.setDataSdkVersion(Reactor.Client.sdkVersion),t=new Date((new Date).getTime()+Reactor.config("sessionTime"))),localStorage.setItem(r,o.getTime())},e}(Reactor.Object),o=Reactor.Conditions.ActionCondition=function(t){function e(t,n){this.test=null!=t?t:"eq",this.value=null!=n?n:"",e.__super__.constructor.call(this,"action")}return K(e,t),e.prototype.isSatisfied=function(t){return this.runTest("action",this.test,t.getAction(),this.value)},e.unpack=function(t){return Reactor.JSON.requiredFields(t,"ActionCondition",["t","v"]),new o(t.t,t.v)},e.fieldMap={test:"t",value:"v"},e.pack=function(t){return Reactor.JSON.mapFields(t,this.fieldMap)},e}(Reactor.Conditions.Condition),T=Reactor.JSON,l=Reactor.Conditions.AttributeCondition=function(t){function e(t,n,r){this.attrName=null!=t?t:"",this.test=null!=n?n:"eq",this.value=null!=r?r:"",e.__super__.constructor.call(this,"attr")}return K(e,t),e.prototype.isSatisfied=function(){return this.runTest("attr",this.test,Reactor.Client.getAttribute(this.attrName),this.value)},e.unpack=function(t){return T.requiredFields(t,"AttributeCondition",["n","t","v"]),new l(t.n,t.t,t.v)},e.fieldMap={attrName:"n",test:"t",value:"v"},e.pack=function(t){return T.mapFields(t,this.fieldMap)},e}(Reactor.Conditions.Condition),g=Reactor.Conditions,d=Reactor.Conditions.ConditionMasterList=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.types={action:g.ActionCondition,attr:g.AttributeCondition,count:g.CountCondition,mem:g.MembershipCondition,ref:g.ReferrerCondition,since:g.SinceCondition,time:g.TimeCondition,day:g.DayCondition},e.smallTypeNames={ac:"action",at:"attr",co:"count",me:"mem",re:"ref",si:"since",ti:"time",da:"day"},e.bigTypeNames={action:"ac",attr:"at",count:"co",mem:"me",ref:"re",since:"si",time:"ti",day:"da"},e}(Reactor.Object),_=Reactor.Log,Reactor.Config=function(t){function e(t,e,n){this.configNodeSelector=t,this.settings=e,this.configuration=n}return K(e,t),e.getOptionAttrName=function(t){var e,n;return e=new RegExp("[A-Z]","g"),n=function(t){return"-"+t.toLowerCase()},"data-"+t.replace(e,n)},e.prototype.configNodeExists=function(){var t;return t=Reactor.Dom.selectOne(this.configNodeSelector),null!=t},e.prototype.getConfigNodeAttr=function(t,e){var n;return n=Reactor.Dom.attr(this.configNodeSelector,t)[0],null==n&&(_.info("No attribute value provided for "+t),n=e),n},e.prototype.initialize=function(){var t,e,n,r,i,o,s;o=this.settings,s=[];for(n in o)r=o[n],t=Reactor.Config.getOptionAttrName(n),i=this.getConfigNodeAttr(t,r.defaultValue),e={},e[n]=i,s.push(this.config(e));return s},e.prototype.getAlias=function(){var t,e=this;return t=this,function(n,r){return e.config.call(t,n,r)}},e.prototype.config=function(t,e){var n,r,i,o,s=this;if("string"==typeof t)return i=t,"undefined"==typeof e?this.configuration[i]:(n={},n[i]=e,this.config(n));r=function(t,e){var n,r;return null==s.settings[t]?new Reactor.Error("No such configurable: "+t):(r=s.settings[t],null!=r.modify&&(n=r.modify(e),e=n),s.configuration[t]=e,_.info("Option '"+t+"' -> '"+e+"'"),null!=r.onChange?r.onChange(e):void 0)},o=[];for(i in t)e=t[i],o.push(r(i,e));return o},e}(Reactor.Object),T=Reactor.JSON,f=Reactor.Clause,R=Reactor.DisplayRule=function(t){function e(t,e){this.mids=t,this.rootClause=e}return K(e,t),e.prototype.isSatisfied=function(t){return this.rootClause.isSatisfied(t)},e.unpack=function(t){var e,n;return Reactor.JSON.requiredFields(t,"DisplayRule",["mids","rc"]),n=f.unpack(t.rc),e=new R(t.mids,n)
},e.fieldMap={mids:"mids",rootClause:"rc"},e.pack=function(t){var e;return e=T.mapFields(t,this.fieldMap),e.rc=f.pack(e.rc),e},e}(Reactor.Object),y=Reactor.DisplayRuleSet,C=Reactor.Duration,j=Reactor.Settings,_=Reactor.Log,Reactor.DisplayRuleSetArchive=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.storage=new Reactor.Storage.Archive("drs_"),e.set=function(t,e){return this.storage.set(t,y.pack(e),j.cacheTime)},e.get=function(t){var e;return e=this.storage.get(t,null),null!=e&&(e=y.unpack(e)),e},e.clear=function(){return this.storage.clear()},e}(Reactor.Object),Reactor.Event=function(t){function e(t,e){this.name=t,this.onTrigger=e}return K(e,t),e.prototype.getName=function(){return this.name},e.prototype.getAction=function(t,e){return this.onTrigger(t,e)},e}(Reactor.Object),T=Reactor.JSON,N=Reactor.EventInstance=function(t){function e(t,e,n,r){this.name=t,this.action=e,this.lastOccurred=n,this.count=r,this.time=new Date,this.timeSinceLast=null==this.lastOccurred?null:this.time.getTime()-this.lastOccurred.getTime()}return K(e,t),e.prototype.getName=function(){return this.name},e.prototype.getAction=function(){return this.action},e.prototype.getCount=function(){return this.count},e.prototype.getTime=function(){return this.time},e.prototype.getTimeSinceLast=function(){return this.timeSinceLast},e.prototype.getLastOccurred=function(){return this.lastOccurred},e.fieldMap={name:"n",action:"a",lastOccurred:"l",count:"c",time:"t",timeSinceLast:"ts"},e.pack=function(t){var e;return e=T.mapFields(t,this.fieldMap)},e.unpack=function(t){var e;return T.requiredFields(t,"EventInstance",["n","a","c","t"]),T.requiredFieldsNullOk(t,"EventInstance",["ts","l"]),e=new N(t.n,t.a,null,t.c),e.time=new Date(t.t),e.timeSinceLast=t.ts,e},e}(Reactor.Object),N=Reactor.EventInstance,Reactor.EventInstanceArchive=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.storage=new Reactor.Storage.Archive("ei_"),e.get=function(t){var e;return e=this.storage.get(t,null),null!=e&&(e=N.unpack(e)),e},e.set=function(t,e){return this.storage.set(t,N.pack(e))},e.clear=function(){return this.storage.clear()},e.remove=function(t){return this.storage.remove(t)},e}(Reactor.Storage.Archive),N=Reactor.EventInstance,k=Reactor.EventInstanceArchive,E=Reactor.NotificationManager,y=Reactor.DisplayRuleSet,S=Reactor.DisplayRuleSetArchive,M=Reactor.Dom,s=Reactor.Ajax,_=Reactor.Log,Reactor.EventManager=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.getLast=function(t){return k.get(t,null)},e.fireEvent=function(t,e,n){var r,i,o,s,a,u,c,l;return c=t.getName(),r=t.getAction(e,n),l=k.get(c),null!=l?(u=new Date(l.time),i=l.count+1):(u=null,i=1),s=new N(c,r,u,i),k.set(c,s),_.info("Handling event '"+c+"' with action '"+r+"'"),a=this,o=function(t,e){return a.handleEvent(s,e)},this.getEventDisplayRules(s.getName(),o)},e.handleEvent=function(t,e){var n,r,i;return i=e.getSatisfiedRules(t),0===i.length?(_.info("No rules satisfied for "+t.name),void 0):(n=function(){var t,e,n;for(n=[],t=0,e=i.length;e>t;t++)r=i[t],n.push(r.mids);return n}(),_.info("Messages for "+t.getName()+" / "+t.getAction()+":",n),this.handleMessages(n))},e.handleMessages=function(t){return E.getMessages(t)},e.registerEvent=function(t,e,n){var r;return r=this,M.registerEvent(t,e,function(t,e){return r.fireEvent(n,t,e)})},e.getEventDisplayRules=function(t,e){var n,r;return n=S.get(t),null===n?(r=function(n){return e(t,n)},this.refreshCachedRules(t,r)):e(t,n)},e.refreshCachedRules=function(t,e){var n,r,i,o;return n=this,i=function(n){var r;return r=y.unpack(n),S.set(t,r),e(r)},r=function(t){return _.error("Error retrieving display rules:",t)},o={url:Reactor.Settings.Api.displayRules+"/"+t,method:"POST",dataType:"json",data:{segments:Reactor.Client.getSegments()},success:i,error:r},_.info("Requesting updated display rules for '"+t+"' from",Reactor.Settings.Api.displayRules),s.ajax(o)},e}(Reactor.Object),_=Reactor.Log,w=Reactor.ExperienceRules=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.updateMessageHistory=function(t){var e,n;return n=Reactor.MessageArchive.getRaw(t),null==n.e&&(n.e={},n.e.mv=1),null==n.hist&&(n.hist={}),e=function(t){var e,r,i,o;for(o=[],r=0,i=t.length;i>r;r++)e=t[r],null!=n.hist[e]?n.hist[e]+=1:n.hist[e]=1;return o},n.hist.last=(new Date).getTime(),e(["v","mo","w","d","h","m"]),Reactor.MessageArchive.set(n.mid,n),n},e.timeUnits={mo:0,w:1,d:2,h:3,m:4},e.resetCounts=function(t,e){var n,r,i,o,s;i=this.timeUnits[e],o=this.timeUnits,s=[];for(r in o)n=o[r],n>=i?s.push(this.reset(t,r)):s.push(void 0);return s},e.reset=function(t,e){return t.hist[e]=0,Reactor.MessageArchive.set(t.mid,t)},e.passes=function(t){var e;return e=Reactor.MessageArchive.getRaw(t),null==e?!0:this.passesMaxDeliveryRules(e)?!0:!1},e.passesMaxDeliveryRules=function(t){return null==t.hist?!0:this.passesMaxViews(t)?this.passesMinInterval(t)?this.passesTimeRules(t)?!0:(_.info("Failed time unit limitations."),!1):(_.info("Failed min interval. "+((new Date).getTime()-t.hist.last)+" / "+t.e.mi),!1):(_.info("Failed max views. "+t.hist.v+" / "+t.e.mv),!1)},e.passesMaxViews=function(t){return!(null!=t.e.mv)||t.hist.v<t.e.mv},e.passesMinInterval=function(t){var e;return!(null!=t.e.mi)||!(null!=(null!=(e=t.hist)?e.last:void 0))||(new Date).getTime()-t.hist.last>=t.e.mi},e.isNewYear=function(t,e,n){return null==e&&(e=new Date(t.hist.last)),null==n&&(n=new Date),e.getFullYear()!==n.getFullYear()},e.isNewMonth=function(t,e,n){return null==e&&(e=new Date(t.hist.last)),null==n&&(n=new Date),this.isNewYear(t,e,n)||e.getMonth()!==n.getMonth()},e.getDayOfYear=function(){var t,e,n,r,i;return r=new Date,n=new Date(r.getFullYear(),0,1),e=r-n,i=864e5,t=Math.floor(e/i)},e.getWeekOfYear=function(t){var e,n;return e=this.getDayOfYear(t),n=Math.floor(e/7)},e.isNewWeek=function(t,e,n){return null==e&&(e=new Date(t.hist.last)),null==n&&(n=new Date),w.getWeekOfYear(e)!==w.getWeekOfYear(n)},e.isNewDay=function(t,e,n){return null==e&&(e=new Date(t.hist.last)),null==n&&(n=new Date),w.getDayOfYear(e)!==w.getDayOfYear(n)},e.isNewHour=function(t,e,n){return null==e&&(e=new Date(t.hist.last)),null==n&&(n=new Date),e.getHours()!==n.getHours()},e.isNewMinute=function(t,e,n){return null==e&&(e=new Date(t.hist.last)),null==n&&(n=new Date),e.getMinutes()!==n.getMinutes()},e.isNewTests={mo:e.isNewMonth,w:e.isNewWeek,d:e.isNewDay,h:e.isNewHour,m:e.isNewMinute},e.passesTimeRules=function(t){var e,n,r,i,o,s=this;for(e=function(e){return null==t.e[e]?!0:s.isNewTests[e](t)?(s.resetCounts(t,e),!0):t.hist[e]<t.e[e]},o=["mo","w","d","h","m"],r=0,i=o.length;i>r;r++)if(n=o[r],!e(n))return!1;return!0},e}(Reactor.Object),h=Reactor.Client,Reactor.MessageArchive=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.storage=new Reactor.Storage.Archive("rn_"),e.addDynamicContent=function(t){var e,n,r;return n=[],e=function(t,e){var r;return h.hasAttribute(e)?(r=h.getAttribute(e),""+r):(n.push(e),t)},r=new RegExp("{{(.*?)}}","g"),null!=t.subject&&(t.subject=t.subject.replace(r,e)),null!=t.body&&(t.body=t.body.replace(r,e)),n.length>0&&(t.error="Could not inject attributes: "+n.join(", ")),t},e.get=function(t){var e;return e=this.storage.get(t,null),null!=e?e=this.addDynamicContent(e):e},e.getRaw=function(t){return this.storage.get(t,null)},e.set=function(t,e){return this.storage.set(t,e)},e.keys=function(){return this.storage.keys()},e.has=function(t){return this.storage.has(t)},e.remove=function(t){return this.storage.remove(t)},e}(Reactor.Object),_=Reactor.Log,Reactor.MessageBatch=function(t){function e(t,e){this.onReady=e,this.messagesToDisplay={},this.retrieveMessages(t)}return K(e,t),e.prototype.getMessageUrl=function(t){return Reactor.Settings.Api.events+"/messages/"+t},e.prototype.addMessageToSet=function(t){return this.messagesToDisplay[t.mid]=t},e.prototype.getMessages=function(){var t,e,n,r;n=this.messagesToDisplay,r=[];for(t in n)e=n[t],r.push(e);return r},e.prototype.retrieveMessages=function(t){var e,n,r,i,o,s,a,u;for(s=[],a=0,u=t.length;u>a;a++)o=t[a],Reactor.MessageArchive.has(o)?this.addMessageToSet(Reactor.MessageArchive.get(o)):s.push(this.getMessageUrl(o));return n=this,i=function(t,e){var r;e.date=(new Date).getTime(),e.subject=e.c.s,delete e.c.s,e.body=e.c.b,delete e.c.b;try{e.customData=JSON.parse(e.c.cd),delete e.c.cd}catch(i){e.customData={error:"Could not parse JSON: '"+e.c.cd+"'"}}return null!=(null!=(r=e.e)?r.de:void 0)&&(e.delay=e.e.de,delete e.e.de),Reactor.MessageArchive.set(e.mid,e),n.addMessageToSet(Reactor.MessageArchive.get(e.mid))},r=function(t,e){return _.error("Could not retrieve message. Request:",t,", XHR:",e)},e=function(){return null!=n.onReady?n.onReady(n.getMessages()):void 0},0!==s.length?Reactor.Ajax.multi(s,i,r,e):0!==this.getMessages().length?e():void 0},e}(Reactor.Object),Reactor.MessageDetails=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.storage=new Reactor.Storage.Archive("md_"),e.get=function(t){return this.storage.get(t,null)},e.set=function(t,e){return e.mid=t,this.storage.set(t,e)},e.update=function(t,e){var n,r,i;r=this.storage.get(t,{});for(n in e)i=e[n],r[n]=i;return r.mid=t,this.storage.set(t,r)},e.remove=function(t){return this.storage.remove(t)},e.keys=function(){return this.storage.keys()},e.getSortedView=function(t,e,n){return new Reactor.MessageIndex(t,e,n)},e}(Reactor.Object),_=Reactor.Log,O=Reactor.MessageIndex=function(t){function e(t,e,n){var r,i,o,s,a,u,c,l;for(this.keys=t,null==n&&(n=function(){return!0}),"string"==typeof this.keys&&(this.keys=[this.keys]),(null==this.keys||0===this.keys.length)&&new Reactor.Error("MessageIndex requires at least one key name."),this.comparatorMap={},this.defaultComparatorMap={},l=this.keys,u=0,c=l.length;c>u;u++)s=l[u],this.defaultComparatorMap[s]=function(t,e){return null!=t&&null!=e?t-e:O.compareNonValues(t,e)},this.comparatorMap[s]=this.defaultComparatorMap[s];if(null!=e)for(s in e)r=e[s],this.comparatorMap[s]=r;a=this.getUnsortedList(),o=function(){var t,e,r;for(r=[],t=0,e=a.length;e>t;t++)i=a[t],n(i)&&r.push(i);return r}(),this.detailsList=O.multiKeySort(o,this.keys.slice(0),this.comparatorMap)}return K(e,t),e.groupEqualItems=function(t,e,n){var r,i,o,s,a,u;if(0===t.length)return t;for(s=null,i=[],o=[],a=0,u=t.length;u>a;a++)r=t[a],null===s||0===n(s,r)?i.push(r):(o.push(i),i=[],i.push(r)),s=r;return o.push(i),o},e.multiKeySort=function(t,e,n){var r,i,o,s,a,u,c,l;if(e=e.slice(0),s=e.shift(),r=function(t,e){var r,i;return r=t[s],i=e[s],n[s](r,i)},t.sort(r),0===e.length)return t;for(a=[],o=this.groupEqualItems(t,s,r),c=0,l=o.length;l>c;c++)i=o[c],u=this.multiKeySort(i,e,n),a=a.concat(u);return a},e.mapToValue=function(t){return null!=t?0:null===t?1:void 0===t?2:void 0},e.compareNonValues=function(t,e){return t=this.mapToValue(t),e=this.mapToValue(e),t-e},e.prototype.count=function(){return this.detailsList.length},e.prototype.getUnsortedList=function(){var t,e;return e=Reactor.MessageDetails.keys(),function(){var n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],i.push(Reactor.MessageDetails.get(t));return i}()},e.prototype.getAll=function(){return this.detailsList},e.prototype.slice=function(t,e){return this.detailsList.slice(t,e)},e.prototype.getFirst=function(t){return null==t&&(t=0),this.slice(0,t)},e.prototype.getLast=function(t){return null==t&&(t=1),this.slice(-1*t)},e}(Reactor.Object),Reactor.Metric=function(t){function e(t,e){this.action=t,this.value=e}return K(e,t),e.prototype.getValue=function(){return this.value},e.prototype.getAction=function(){return this.action},e}(Reactor.Object),_=Reactor.Log,Reactor.Scheduler=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.storage=new Reactor.Storage.Archive("sc_"),e.currentName=null,e.currentId=null,e.maxEvents=10,e.scheduleDelayedEvent=function(t,e,n,r){var i,o;return null==r&&(r=null),i=new Date((new Date).getTime()+n),o=null!=r?new Date(i.getTime()+r):null,this.scheduleEvent(t,e,i,o)},e.scheduleEvent=function(t,e,n,r){var i,o,s;if(null==r&&(r=null),o=null,this.storage.keys().length>=this.maxEvents)return o;if(s=(new Date).getTime(),!this.isValidDate(n))throw new Reactor.Error("Invalid Schedule Time Provided");if(null!=r){if(!this.isValidDate(r))throw new Reactor.Error("Invalid Expiration Time Provided");r=new Date(r).getTime()-s,_.info("Scheduled job will expire in "+new Reactor.Duration(r).toString())}return i={name:t,action:e,date:n},this.storage.set(t,i,r),null===this.currentName?this.loadEvent(i):void 0},e.isValidDate=function(t){return!isNaN(new Date(t).getTime())},e.loadNextEvent=function(){var t;return t=this.getNextEvent(),null!=t?this.loadEvent(t):void 0},e.loadEvent=function(t){var e,n,r,i,o=this;return r=new Reactor.Event(t.name,function(){return t.action}),n=function(){return Reactor.EventManager.fireEvent(r,null),o.unscheduleEvent(t.name),o.loadNextEvent()},this.currentName=t.name,i=(new Date).getTime(),e=new Date(t.date).getTime()-i,_.info("Job scheduled for "+t.date+" will fire in "+new Reactor.Duration(e).toString()),this.currentId=setTimeout(n,e)},e.unscheduleEvent=function(t){return this.storage.remove(t),this.currentName===t?(this.currentName=null,clearTimeout(this.currentId),this.currentId=null):void 0},e.getEventList=function(){var t,e,n,r,i,o;for(n=[],o=this.storage.keys(),r=0,i=o.length;i>r;r++)e=o[r],t=this.storage.get(e),null!=t?n.push(t):_.info("Event with key "+e+" expired without being triggered.");return n.sort(this.comparator)},e.getNextEvent=function(){return this.getEventList()[0]||null},e.comparator=function(t,e){var n,r;return n=new Date(t.date),r=new Date(e.date),n.getTime()-r.getTime()},e}(Reactor.Object),_=Reactor.Log,Reactor.Setup=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return K(e,t),e.configNodeSelector="#reactor-sdk",e.onAppKeyChange=function(){return e.updateApiUrls(Reactor.Settings.apiBase)},e.onApiBaseChange=function(t){return e.updateApiUrls(t)},e.onProtocolChange=function(){return e.updateApiUrls(Reactor.Settings.apiBase)},e.updateApiUrls=function(t){var e;return e=Reactor.Settings.Api,e.base=Reactor.Settings.protocol+"//"+t,e.events=e.base+"/event/"+Reactor.Settings.appKey,e.displayRules=e.events+"/display-rules",e.segments=e.events+"/segments",e.metrics=e.base+"/metrics/"+Reactor.Settings.appKey},e.modifiers={none:function(t){return t},secondsToMs:function(t){return 1e3*t},strToBool:function(t){return"true"===t||t===!0},stripProtocol:function(t){return t.replace(/^\w*:\/\//,"")}},e.settings={appKey:{defaultValue:null,modify:null,onChange:e.onAppKeyChange},sessionTime:{defaultValue:1200,modify:e.modifiers.secondsToMs,onChange:null},cacheTime:{defaultValue:600,modify:e.modifiers.secondsToMs,onChange:null},autoRun:{defaultValue:"true",modify:e.modifiers.strToBool,onChange:null},apiBase:{defaultValue:"api.ibm.xtify.com/3.0",modify:null,onChange:e.onApiBaseChange},protocol:{defaultValue:"https:",modify:e.modifiers.stripProtocol,onChange:e.onProtocolChange},logLevel:{defaultValue:_.defaultLevelName,modify:null,onChange:_.setLevel},campaignVariable:{defaultValue:"utm_campaign",modify:null,onChange:null}},e}.call(this,Reactor.Object),_=Reactor.Log,r=!1,i=[],e=function(){var t,e,n;for(r=!0,e=0,n=i.length;n>e;e++)t=i[e],t();return i=[]},Reactor.Dom.ready(e),Reactor.ready=function(t){return null!=t?r?t():i.push(t):void 0},Reactor.reset=function(){return Reactor.Storage.Archive.resetAllStorage()},Reactor.onBeforeMessage=function(t){return null!=t?Reactor.NotificationManager.onBeforeMessageCallback=t:Reactor.NotificationManager.onBeforeMessageCallback},Reactor.onMessage=function(t){return null!=t?Reactor.NotificationManager.onMessageCallback=t:Reactor.NotificationManager.onMessageCallback},Reactor.onAfterMessage=function(t){return null!=t?Reactor.NotificationManager.onAfterMessageCallback=t:Reactor.NotificationManager.onAfterMessageCallback},Reactor.loadMessages=function(t,e){return new Reactor.MessageBatch(t,e)},Reactor.Dom.registerEvent(".reactor-msg a","click",function(t){var e,n;return n=Reactor.Dom.closest(t,".reactor-msg"),e=n.getAttribute("data-cid"),Reactor.MetricsManager.report(Reactor.MetricsManager.actions.CLICK,e)}),q=Reactor.Setup,n=new Reactor.Config(q.configNodeSelector,q.settings,Reactor.Settings),n.initialize(),Reactor.config=n.getAlias(),Reactor.Modules={},Reactor.start=function(){var t,e,n,r;if(null!=Reactor.Settings.appKey){_.info("App Key:",Reactor.Settings.appKey),Reactor.Client.updateSession(),Reactor.Scheduler.loadNextEvent(),n=Reactor.Modules,r=[];for(e in n)t=n[e],_.info("Starting module '"+e+"': ",t),null!=t.start?r.push(t.start()):r.push(_.error("No start() function found for module '"+e+"'",t));return r}return new Reactor.Error("No appKey has been provided!")},n.configNodeExists()||Reactor.config("autoRun",!1),Reactor.config("autoRun")===!0&&Reactor.start(),t=window.$r=Reactor,t.cl=t.Client,t.em=t.EventManager}).call(this);(function(){var t,e,o,i=function(t,e){return function(){return t.apply(e,arguments)}};o=Reactor.Log,e=function(){function t(e,o){this.destroy=i(this.destroy,this),null!==t.existingModal&&t.existingModal.destroy(),this.body=Reactor.Dom.create("div",o),this.body.setAttribute("class","reactor-simple-modal-body"),this.closeButton=Reactor.Dom.create("span","[close]"),this.closeButton.setAttribute("class","reactor-simple-modal-close"),this.closeButton.onclick=this.destroy,this.modal=Reactor.Dom.create("div",""),this.modal.appendChild(this.body),this.modal.appendChild(this.closeButton),this.modal.setAttribute("class","reactor-simple-modal"),this.modal.setAttribute("title",e),this.domElem=Reactor.Dom.create("div",""),this.domElem.appendChild(this.modal),t.existingModal=this}return t.modalCSS="	    .reactor-simple-modal\n	    {\nbackground: rgba(255, 255, 255, .9);\nposition: fixed;\n    bottom: 0px;\n    left: 0px;\n    right: 0px;\n    padding: 15px;\n    padding-top: 25px;\n    max-height: 50%;\n    box-shadow: 0px -5px 5px #555555;\n    z-index: 5001;\n}",t.bodyCSS="",t.closeButtonCSS=".reactor-simple-modal-close\n{\n	right: 2px;\n    top: 2px;\n    color: gray;\n    position: absolute;\n    cursor: pointer;\n}",t.existingModal=null,t.prototype.destroy=function(){return Reactor.Dom.body().removeChild(this.domElem),t.existingModal=null},t.applyCSS=function(){var e,o;return o=t.modalCSS+"\n"+t.closeButtonCSS,e=Reactor.Dom.addStyle(o),e.setAttribute("data-created-by","reactor-simple-display")},t}(),t={},t.dismiss=function(){return null!=e.existingModal?e.existingModal.destroy():void 0},t.displayCallback=function(t){var i;return o.info("Received a message:",t),i=new e(t.subject,t.body),Reactor.Dom.body().appendChild(i.domElem)},t.registerDisplayCallback=function(){return o.info("Registering the SimpleDisplay message handler"),Reactor.onMessage(t.displayCallback)},t.start=function(){return o.info("Starting SimpleDisplay..."),e.applyCSS(),Reactor.ready(t.registerDisplayCallback)},Reactor.config("autoRun")&&t.start(),Reactor.Modules.SimpleDisplay=t,Reactor.Modules.SimpleDisplay.SimpleModal=e}).call(this);(function(){var t;t=function(){function t(){}return t.platforms=[{iPhone:{string:navigator.userAgent,subString:"iPhone",id:"iPhone"},iPod:{string:navigator.userAgent,subString:"iPod",id:"iPod"},iPad:{string:navigator.userAgent,subString:"iPad",id:"iPad"},Android:{string:navigator.userAgent,subString:"Android",id:"Android"},"Windows Phone":{string:navigator.userAgent,subString:"Windows Phone",id:"Windows Phone"},Windows:{string:navigator.platform,subString:"Win",id:"Windows"},Mac:{string:navigator.platform,subString:"Mac",id:"Mac"},Linux:{string:navigator.platform,subString:"Linux",id:"Linux"},BlackBerry:{string:navigator.userAgent,subString:"BlackBerry",id:"BlackBerry"},"BlackBerry 10":{string:navigator.userAgent,subString:"BB10",id:"BlackBerry"}}],t.detectPlatform=function(){var n,i,r,e,o,a;if(r=Reactor.Client.getAttribute("platform",null),null!=r)return console.log("Platform already attempted with result:",r),void 0;for(console.log("Detecting device platform..."),a=t.platforms,e=0,o=a.length;o>e;e++){r=a[e];for(i in r)if(n=r[i],n.string.match(new RegExp(n.subString,"i")))return console.log("Platform found:",n.id,"('"+i+"' in '"+n.string+"')"),Reactor.Client.setAttribute("platform",n.id),Reactor.Client.updateSegments(),void 0}console.log("No platform could be found."),Reactor.Client.setAttribute("platform","unknown"),Reactor.Client.updateSegments()},t.start=function(){return console.log("Starting DeviceDetection..."),Reactor.ready(t.detectPlatform)},t}(),Reactor.config("autoRun")&&t.start(),Reactor.Modules.DeviceDetection=t}).call(this);(function(){var e,t,n;e={sessionTime:Reactor.config("sessionTime"),campaignVariable:Reactor.config("campaignVariable")},n=Reactor.Log,t=Reactor.Client,e.registerCoreEvents=function(){var n,r,a,i;return a=new Date,r=t.getAttribute("lastVisit",null),null!=r?(n=new Date(r.getTime()+e.sessionTime),a>n?e.startNewSession(!1):(i=new Reactor.Duration(n.getTime()-a.getTime()),e.registerPageView())):e.startNewSession(!0),t.setAttribute("lastVisit",a)},e.startNewSession=function(){var r,a,i;return i=t.getAttribute("sessionCount",0),t.setAttribute("sessionCount",i+1),Reactor.EventInstanceArchive.remove("PAGE_VIEW"),a=Reactor.Client.getQueryVars(),null!=a[e.campaignVariable]&&t.setAttribute("campaign",a[e.campaignVariable]),r=function(){var t,r;return n.info("Firing session start."),t=function(){return document.referrer},r=new Reactor.Event("SESSION_START",t),Reactor.EventManager.fireEvent(r,null),e.registerPageView()},t.updateSegments(r,r)},e.registerPageView=function(){var e,t;return e=function(){return document.location.pathname},t=new Reactor.Event("PAGE_VIEW",e),Reactor.EventManager.fireEvent(t,null)},e.start=function(){return Reactor.ready(e.registerCoreEvents)},Reactor.config("autoRun")&&e.start(),Reactor.Modules.CoreEvents=e}).call(this);