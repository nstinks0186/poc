/*
 *  Licensed Materials - Property of IBM
 *  5725E28, 5725I03
 *  Â© Copyright IBM Corp. 2014
 *  US Government Users Restricted Rights - Use, duplication or disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
 */
(function(){var e,t,n;t=Reactor.Log,n=e=function(){function e(){}return e.cssPrefix="reactor-simple-inbox",e.isActive=!1,e.cssRules="        div."+e.cssPrefix+".active\n        {\n            bottom: 0em;\n        }\n\n        div."+e.cssPrefix+"-tab\n        {\n            right: 30px;\n            bottom: 0em;\n        }\n\n        div."+e.cssPrefix+"-tab.active\n        {\n            bottom: 20em;\n        }\n\n        div."+e.cssPrefix+"\n        {\n            width: 300px;\n            height: 20em;\n            right: 15px;\n            bottom: -20em;\n        }\n\n        @media handheld, screen and (max-height: 23em), handheld and (orientation: landscape)\n        {\n	        div."+e.cssPrefix+"\n	        {\n	            height: 11em;\n	        }\n\n	        div."+e.cssPrefix+"-tab.active\n	        {\n	            bottom: 11em;\n	        }\n\n	        div."+e.cssPrefix+"\n	        {\n	            bottom: -11em;\n	        }\n        }\n\n        @media (orientation: portrait) and (max-width: 350px)\n        {\n	        div."+e.cssPrefix+"\n	        {\n		        left: 0px;\n		        right: 0px;\n		        width: auto;\n	        }\n        }\n\n        div."+e.cssPrefix+"\n        {\n	        position: fixed;\n\n	        padding: 15px;\n	        padding-bottom: 0px;\n\n	        background: white;\n	        color: black;\n	        box-sizing: border-box;\n	        -moz-box-sizing: border-box;\n\n	        z-index: 4500;\n	        box-shadow: 0 0 5px 5px #888;\n	        transition: bottom 1s, height 1s;\n        }\n\n        div."+e.cssPrefix+"-tab.reactor-shadow\n        {\n	        z-index: 4000;\n	        box-shadow: 0 0 5px 5px #888;\n        }\n\n        div."+e.cssPrefix+"-tab\n        {\n	        background: white;\n	        text-align: center;\n\n	        position: fixed;\n\n	        border-top-left-radius: 3px;\n	        border-top-right-radius: 3px;\n	        padding: .3em;\n	        padding-left: .5em;\n	        padding-right: .5em;\n\n	        z-index: 5000;\n	        cursor: pointer;\n	        transition: bottom 1s;\n        }\n\n        div."+e.cssPrefix+"-wrapper\n        {\n	        position: absolute;\n	        top: 15px;\n	        right: 15px;\n	        left: 15px;\n	        bottom: 0px;\n	        box-sizing: border-box;\n        }\n\n        div."+e.cssPrefix+"-message-list\n        {\n	        position: relative;\n	        height: 100%;\n\n	        overflow-y: auto;\n	        display:none;\n        }\n\n        div."+e.cssPrefix+"-message-list.active\n        {\n            display: block;\n        }\n\n        div."+e.cssPrefix+"-entry\n        {\n	        background-color: white;\n	        border-top: thin dotted #555;\n	        padding: 8px;\n	        cursor: pointer;\n	        color: black;\n	        transition: color 2s;\n        }\n\n        div."+e.cssPrefix+'-entry:after\n        {\n	        content:"";\n	        display:table;\n	        clear:both;\n        }\n\n        div.'+e.cssPrefix+"-entry:hover\n        {\n            background-color: #EEE;\n        }\n\n        div."+e.cssPrefix+"-entry span.info\n        {\n	        float: right;\n	        font-size: small;\n        }\n\n        div."+e.cssPrefix+"-entry.new\n        {\n            color: DodgerBlue;\n        }\n\n        div."+e.cssPrefix+"-entry.read\n        {\n            color: #888;\n        }\n\n        div."+e.cssPrefix+"-entry.deleted\n        {\n            display: none;\n        }\n\n        div."+e.cssPrefix+"-message-view\n        {\n	        position: relative;\n	        height: 100%;\n	        overflow-y: auto;\n	        display:none;\n        }\n\n        div."+e.cssPrefix+"-message-view.active\n        {\n            display:block;\n        }\n\n        div."+e.cssPrefix+"-message\n        {\n	        margin-top: 5px;\n	        border-top: thin dotted black;\n	        padding-top: 15px;\n        }\n\n        div."+e.cssPrefix+"-return\n        {\n            cursor: pointer;\n        }\n\n        div."+e.cssPrefix+" span.delete\n        {\n	        height:1em;\n	        width: 1em;\n	        position:relative;\n	        display: inline-block;\n        }\n\n        div."+e.cssPrefix+" span.age\n        {\n	        margin-right: 10px;\n	        font-size: x-small;\n        }\n\n        div."+e.cssPrefix+" span.delete img\n        {\n            height: 100%;\n	        bottom: 0px;\n	        left: 0px;\n	        width: 100%;\n	        position: absolute;\n        }\n\n        div."+e.cssPrefix+"-tab img\n        {\n            height: 1.6em;\n        }\n\n        div."+e.cssPrefix+"-tab.new-mail img\n	    {\n            box-shadow: 0px 0px 10px 1px DodgerBlue;\n	    }\n\n	    ."+e.cssPrefix+"-empty-message\n	    {\ncolor: #CCC;\n	        text-align: center;\n	    }",e.trashGlyphSource="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAABICAYAAACp+JiNAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAOYSURBVHic7Zu9bhNBFIW/AxYBokAAQQNFEA1UUEFBaBASEhVQwQMAT0ABFTRpEA+QkoK0NAgJQQEp6FIHCpAQvxIkiJ8IARGXwrNysvZ41/Zswoz3SNbY6+Or8dG9587O7mJmhH4BV4E/gAV8/QGuVjHfDVSD80AjcMyGixscoSeaQW68DtwLEO8cMLUiblBUJUKGD2b2fNAgkj6EmIwPVZVDVKhFABqSjgOnCFtv+9x4VtJEgHhHsriSbgSIl8GAxwIWgJ0BA8eGRdFUA+AB8H0dJ7PWGAPOQLMEMhEOhXDyWCDpIDAPtTECtQhALQKw2hOGFhuAufWexDpjTjTPHw7QWiwdBe4An4ET6zSxKvCI5iLuCjDrjhnwsmFmy8CLjClpxL0dS6llrvhf8/n/1ckYF904ImlrpTNbW2xzY9uCsJsIkMhyWtImIMuEb/nv20QwsyXgl/uYhAg0l8gZikVwyLIhFRG2rXhfqhygJcKubpElHZN0X9IrSTd9HiLpoKQZSW8k3Za028PbK2la0ns37vfwxiXdkvRO0l1Jh7vNk5YIv83sV9u3nt3iWZrt41LBrvIzVu8IX/TwZnK8ax7eVI437eFdzvEeFsxz0vE+9bLbXFgOksaBY7nD5zz00xXzTkra7uFCl84Ag3nCeIff7/Fw83F8vHz5dSybDrwGsMPDhZYIbaYIfhEW3JiaMQbPhJiQtcieMiE1Efoqh1ItMiLU5UBtjEDLE/rKhC2SNgef0tpjIE+ANLKhdxHM7Afw231MSYSeygHgixtTEKGvdQK0zDGFNtmXJ0BabbKv7gCJiCBpFNjoPg5tJqzcWhvOTGD11lrfxpiKCD/dNZY2DFMmeG9AGQYRuq4RoJwIsa8T6kygYKEE5Yxx1F3GihUDiZDKmWT/5WBm32neXg9xizCQMUIaZ5IDlQOkYY4DdQdI43S6zgQKTqNhOESoM4FaBCCAMUYtgqSNQHb3TN+ZEPueQuGuEpTPhFhbZOGuEiReDhTctZahrAhjkqp+hrIKZOWwZGZ/faSyIkCc2VDYHqFABDP7CmSbk8MpgkPMZ5KFawQoJ0LM5li4lwDlHhj3tcll4HXu2EdPjDzvrYfnO57Hxw4xO11TKJUJvYiwKhPM7C0wUeL3mFlZ3mRJ3oUyPAJ6QsyrxmAipOAJQ22MpTKhF0/Y554vjgnZjeTBRJjEPWAdIQYuh6eUb13/I94DT7oR/gE3EvcazgYCNQAAAABJRU5ErkJggg==",e.envelopeSource="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE8AAAAzCAYAAADW1FU8AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALHwAACx8B2+0TbwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAQ5SURBVGiB7dtbiBdVHAfwz6wrJmpmkpmkiCDZQ4UJRjcfpOihCCKigogiKOohottDQVEQVgRRD1FEvfgQ9dANoyCkgopudEEK7EIXidoKu5epu9PDzN/Onva//8uc+Y+6/wMDuzO/8z3nfP7//87szG6G3LD11UaansCB3Ebb7P8Fvw5yIvt5m4Ol8c52eHtwSZ7nr9c6pQOgZVm2DM+bAi/82P6GsfLrI7A1y7LLap/dftyyLDsR72BduWs3doU1ebl9heX4MNiX4x6M5HluJm04H38GDj/i9NKpte8/vLLTPDwbAT6H+U0vaIBwt2IiWP/HWFUea49XFmS4OwL8CCuaXljNaHOwOVr3Szg0qJkeLyi8FP8ENWM4uelF1gS3BG9EcA9iVlTXHV5ZfCp+COp2Kc7EjS84IdxxEcoeXNOmtnu8ssNKbItelbuQNb3wBHBnK640Wuv6GWdOU98bXtlpAbZEgE9jXtMAFeCux3iwns+xpkOf3vHKjiO4LwJ8H0c3DdEj2mw8Gq3jVSzuom9/eEHAFYoLxlbf77C+aZQu5344XongHsPsLvtXwytDNuCnoP/fuKhpnA5zPgafBXMex409ZlTHK4NW4ZPoVbxzfzyR4IzyZNCa5+84t4+cNHhl2EK8GAE+hblNgwVzvFpx+dGa3zc4oc+sdHhl4Cw8EAG+h2UNo81SXOiG83oLR1bITIsXBF8VvcLfYl1DcAsVv1qFcE/gkIq59eCV4RuxM8j9CxcMGC7+WTyB2xNl14dXDrAa26PJ3zYguA2K20fhVcCFCfPrxSsHOQwvp/7YdBjzcpNvZCS//hwIXjnQKB6KAN/G0sTjjODeaJwPsLyGNe3Dq/XpWZ7ne/FptHs93s2ybG2KMbIsm49ncFOw+0ucluf5jhRjTNfqfOddZ/K7ITwT/4HzKuZP9digtW1KvZ6BfWyngHscaxTvxPBEckuf+Sfh+yBrl+IuT62AteO1gRspjy3C1uj4ZszpIf9ixVm01X8Mp5THNtUJWCvedHBBzSgejurexJIO2RnuiPptw8qorjbA2vC6gYvqr8XeoP5rHN+mdi6ejPJfwII29bUA1oLXK1zQ7yzFn3e0+v3vbgeOUjx8DvPv75RfB2ByvH7hgv7H4oug/zhuLo+txY7g2G5c2UN2UsCkeFXhgpzFeC3K2qK4pGl9vxMb+8hOBpgMLxVckDdbcUs8n2LbjtUVspMAJsFLDRdl32DyU62tWJQgtzJgZbw64YIxzlE8T30EowlzKwFWwhsEXDBW0hsIKQD7xhskXN1bv4B94R1McFUAe8Y7GOH6BewJ72CG6wewa7yZANcrYFd4MwmuF8COeDMRrlvAafFmMlw3gG3xhnCdAdvh7R3CdQZshzeE6w5wYjq8IVxnwBx51hIM2o5Sd9gmtxWKB1D72lR4w9ZlG/6zcoX2LwmBhbTnmCVNAAAAAElFTkSuQmCC",e.trashIcon=Reactor.Dom.create("img",null,{src:e.trashGlyphSource}),e.envelopeIcon=Reactor.Dom.create("img",null,{src:e.envelopeSource}),e.prefix=function(e){return null==e||""===e?this.cssPrefix:this.cssPrefix+"-"+e},e.loadMessageList=function(){var e,i,s,a,o,r,d,l,c,p,g,h,m,x,u,A,b,v,f,w,D,L,C,I,P=this;if(this.messageList.innerHTML="",u=new Date,l=function(e){var n,i,s;return n=!0,i=!1,null!=e.exp&&(s=new Date(e.exp),u>s?(t.info("Message "+e.mid+" expired at:",s),n=!1):t.info("Message "+e.mid+" will expire at:",s)),e.deleted===!0&&(i=!0),n&&!i},f=Reactor.MessageDetails.getSortedView("addedToInbox",null,l),r=f.getFirst(10),r.reverse(),v=function(){var e,t;return t="Inbox is Empty",e=Reactor.Dom.create("h4",t),e.classList.add("reactor-simple-inbox-empty-message"),P.messageList.appendChild(e)},0===r.length)return v(),void 0;for(g=!0,C=0,I=r.length;I>C;C++)o=r[C],x=o.mid,m=Reactor.MessageArchive.get(x),null==m.error?(g=!1,d=Reactor.Dom.create("div"),d.classList.add(this.prefix("entry")),o.read&&d.classList.add("read"),o.deleted&&d.classList.add("deleted"),d.setAttribute("data-mid",x),w=Reactor.Dom.create("span",m.subject),w.classList.add("subject"),d.appendChild(w),c=Reactor.Dom.create("span"),c.classList.add("info"),d.appendChild(c),A=5e3,u=(new Date).getTime(),o=Reactor.MessageDetails.get(x),D=u-o.addedToInbox,A>D&&o.old!==!0&&(d.classList.add("new"),s={entry:d,mid:x},h=function(){return s.entry.classList.remove("new")},console.log("Scheduling old age for:",d,"mid",x),setTimeout(h,A)),Reactor.MessageDetails.update(x,{old:!0}),A>D?i="new":(L=new Reactor.Duration(D),p=L.largestCommonUnit(),i=Math.floor(L.asUnit(p))+" "+p+" ago"),e=Reactor.Dom.create("span",i),e.classList.add("age"),c.appendChild(e),b=function(e){return d=Reactor.Dom.closest(this,"."+n.prefix("entry")),x=d.getAttribute("data-mid"),t.info("Deleting:",x,"entry:",d),Reactor.MessageDetails.update(x,{deleted:!0}),d.classList.add("deleted"),e.stopPropagation(),n.loadMessageList()},a=Reactor.Dom.create("span",this.trashIcon.outerHTML,{title:"Delete"}),a.classList.add("delete"),a.addEventListener("click",b),c.appendChild(a),this.messageList.appendChild(d)):t.info("Not showing inbox message",m.mid," (Subject: "+m.subject+" because it contained an error: "+m.error);return g===!0?v():void 0},e.buildInbox=function(){return this.inbox=Reactor.Dom.create("div"),this.inbox.classList.add(this.prefix()),Reactor.Dom.body().appendChild(this.inbox),this.tab=Reactor.Dom.create("div",this.envelopeIcon.outerHTML,{title:"My Offers"}),this.tab.classList.add(this.prefix("tab")),this.inbox.appendChild(this.tab),this.wrapper=Reactor.Dom.create("div"),this.wrapper.classList.add(this.prefix("wrapper")),this.inbox.appendChild(this.wrapper),this.messageList=Reactor.Dom.create("div"),this.messageList.classList.add(this.prefix("message-list")),this.messageList.classList.add("active"),this.wrapper.appendChild(this.messageList),this.loadMessageList(),this.messageView=Reactor.Dom.create("div"),this.messageView.classList.add(this.prefix("message-view")),this.wrapper.appendChild(this.messageView),this.returnButton=Reactor.Dom.create("div","&lt;&lt; Back to Inbox"),this.returnButton.classList.add(this.prefix("return")),this.messageView.appendChild(this.returnButton),this.messagePane=Reactor.Dom.create("div"),this.messagePane.classList.add(this.prefix("message")),this.messageView.appendChild(this.messagePane)},e.onInboxEntryClick=function(t){var n,i,s,a;return s=t.getAttribute("data-mid"),n=t.getAttribute("data-cid"),t.classList.add("read"),t.classList.remove("new"),i=Reactor.MessageArchive.get(s),null===i||(Reactor.MessageDetails.update(s,{read:!0}),e.messagePane.innerHTML=i.body,e.toggleView()),a=Reactor.MetricsManager,a.report(a.actions.VIEW,n)},e.addTabShadow=function(){var e;return e=this.tab.cloneNode(!0),e.id="inbox-tab-shadow",e.classList.add("reactor-shadow"),Reactor.Dom.body().appendChild(e)},e.onTabClick=function(){var t,n,i,s,a;for(e.inbox.classList.toggle("active"),e.isActive=!e.isActive,e.tab.classList.remove("new-mail"),n=document.getElementsByClassName("reactor-simple-inbox-tab"),a=[],i=0,s=n.length;s>i;i++)t=n[i],a.push(t.classList.toggle("active"));return a},e.toggleView=function(){return e.messageView.classList.toggle("active"),e.messageList.classList.toggle("active")},e.applyCSS=function(){var n;return t.info("Applying SimpleInbox CSS..."),n=Reactor.Dom.addStyle(e.cssRules),n.setAttribute("data-created-by","reactor-simple-inbox")},e.start=function(){var n,i;return this.applyCSS(),this.buildInbox(),this.addTabShadow(),Reactor.Dom.registerEvent("."+this.prefix("entry"),"click",this.onInboxEntryClick),Reactor.Dom.registerEvent("."+this.prefix("return"),"click",this.toggleView),Reactor.Dom.registerEvent("."+this.prefix("tab"),"click",this.onTabClick),i=Reactor.MessageDetails,n=function(n){var s,a,o,r,d,l,c,p,g,h,m,x,u,A,b,v,f;for(d=[],g=0,m=n.length;m>g;g++){if(o=n[g],r=o.mid,s=i.get(r),i.update(r,{addedToInbox:(new Date).getTime(),old:!1,deleted:!1}),null!=(null!=(u=o.customData)?u.expirationDate:void 0))a=new Date(o.customData.expirationDate).getTime(),i.update(r,{exp:a});else if(null!=(null!=(A=o.customData)?A.timeToLive:void 0)){for(l=o.customData.timeToLive,c=0,b=Reactor.Duration.unitsBigToSmall,h=0,x=b.length;x>h;h++)p=b[h],null!=l[p]&&(c+=Reactor.Duration.unitsAsMS[p]*l[p]);i.update(r,{exp:(new Date).getTime()+c})}e.isActive?t.info("Inbox is open; diverting incoming message to inbox:",o):null!=(null!=(v=o.customData)?v.inboxOnly:void 0)==!0?(t.info("Inbox only message:",o),e.tab.classList.add("new-mail")):(t.info("Allowing message to be displayed:",o),d.push(o),null!=(null!=(f=o.customData)?f.skipInbox:void 0)==!0&&i.update(r,{deleted:!0})),e.loadMessageList()}return d},Reactor.onBeforeMessage(n)},e}.call(this),Reactor.config("autoRun")&&e.start(),Reactor.Modules.SimpleInbox=e}).call(this);